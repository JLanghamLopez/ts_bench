# TS-Bench

## Overview

TS-Bench is a time-series benchmark evaluation system using an Agent-to-Agent (A2A)
architecture. The **green agent** ([ts_task_agent.py]) manages task distribution and
evaluation for time-series forecasting and generation tasks.

## Green Agent Workflow

The green agent (`TSTaskAgent`) operates in two modes:

### 1. Task Assignment Mode

**Trigger**: Receive `EvalRequest` with `task_type` (no results)

**Process**:
1. Validate task type ("time-series-forecasting" or "time-series-generation")
2. Retrieve all tasks of that type from `TaskBank`
3. Generate presigned S3 URLs for task data and evaluation functions
4. Return `TaskAssignment` objects to purple agents

**Output**: List of tasks with data URLs, descriptions, and difficulty levels

### 2. Task Evaluation Mode

**Trigger**: Receive `EvalRequest` with `task_type` + `results`

**Process**:
1. Validate submitted results structure and metrics
2. Normalize metrics
3. Computes per-task scores from the primary metric (RMSE for forecasting, SigW1 for generation)
4. Apply difficulty weights (Easy/Intermediate/Advanced)
5. Aggregate weighted scores into final score
6. Generate LLM-based feedback (Optional)

**Important**: Evaluation compares predictions generated by **purple agents** against ground truth.
The current `TaskAgent` pipeline assumes results are received from purple agents after they process
the assigned tasks.

## Metrics

### Forecasting Tasks
- **Primary**: RMSE (Root Mean Square Error)
- Secondary: MAE, Quantile Loss

### Generation Tasks
- **Primary**: SigW1 (Signature Wasserstein-1)
- Secondary: Auto-correlation, Cross-correlation

## Developers

## Installation

Dependencies can be installed with [poetry](https://python-poetry.org/) by running

```commandline
poetry install
```

which will create a virtual environment in the repo at `.venv` which can
be activated with

```commandline
source .venv/bin/activate
```

## Running

Run an example scenario locally using

```commandline
python -m ts_bench.run_scenario scenario.toml
```

## Developers

### Code Checks

- Linting/formatting can be using pre-commit
  ```commandline
  pre-commit run --all-files
  ```
